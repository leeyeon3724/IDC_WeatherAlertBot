{
  "version": 1,
  "rules": [
    {
      "id": "cycle-cost-spike",
      "event": "cycle.cost.metrics",
      "threshold_display": "1시간 평균 대비 api_fetch_calls 또는 notification_attempts >= 2x",
      "fields": [
        "api_fetch_calls",
        "notification_attempts",
        "notification_failures",
        "pending_total"
      ],
      "response": "호출량/전송량 급증 구간 확인, 최근 설정/장애 이벤트와 상관관계 점검",
      "followup": "`AREA_CODES`, 재시도/주기 설정 재조정 후 24시간 추세 재평가"
    },
    {
      "id": "area-failed-burst",
      "event": "area.failed",
      "threshold_display": "5분 합계 >= 20",
      "fields": [
        "error_code",
        "area_code",
        "error"
      ],
      "eval": {
        "type": "count_gte",
        "window_sec": 300,
        "count": 20
      },
      "response": "네트워크/API 상태 점검, 실패 지역 편중 여부 확인",
      "followup": "임시로 `CYCLE_INTERVAL_SEC` 상향 후 장애 원인 분리"
    },
    {
      "id": "notification-final-failure-burst",
      "event": "notification.final_failure",
      "threshold_display": "10분 합계 >= 5",
      "fields": [
        "attempts",
        "event_id",
        "error"
      ],
      "eval": {
        "type": "count_gte",
        "window_sec": 600,
        "count": 5
      },
      "response": "Webhook URL/권한/수신 시스템 상태 점검",
      "followup": "실패 이벤트 재전송 여부 확인, 웹훅 교체 시 설정 반영"
    },
    {
      "id": "notification-circuit-opened",
      "event": "notification.circuit.opened",
      "threshold_display": "단일 이벤트 즉시 경고",
      "fields": [
        "consecutive_failures",
        "reset_sec"
      ],
      "eval": {
        "type": "single_event"
      },
      "response": "반복 실패 폭주로 판단, 웹훅/네트워크 즉시 점검",
      "followup": "회로 닫힘(`notification.circuit.closed`) 이후 정상 전송 복구 여부 확인"
    },
    {
      "id": "notification-backpressure-applied",
      "event": "notification.backpressure.applied",
      "threshold_display": "10분 합계 >= 1",
      "fields": [
        "area_code",
        "max_attempts_per_cycle",
        "skipped"
      ],
      "eval": {
        "type": "count_gte",
        "window_sec": 600,
        "count": 1
      },
      "response": "사이클 전송 예산 도달 여부 확인, 실패 누적 원인 확인",
      "followup": "`NOTIFIER_MAX_ATTEMPTS_PER_CYCLE` 조정 및 실패 원인 제거"
    },
    {
      "id": "health-notification-outage-detected",
      "event": "health.notification.sent",
      "variant": "outage_detected",
      "threshold_display": "단일 이벤트 즉시 경고",
      "fields": [
        "health_event"
      ],
      "eval": {
        "type": "single_event"
      },
      "response": "장애 공지 전파, 외부 의존성 상태 확인",
      "followup": "heartbeat 발생 추세 모니터링 및 복구 조건 점검"
    },
    {
      "id": "health-notification-outage-heartbeat",
      "event": "health.notification.sent",
      "variant": "outage_heartbeat",
      "threshold_display": "2회 연속 발생",
      "fields": [
        "health_event"
      ],
      "eval": {
        "type": "count_gte",
        "window_sec": 7200,
        "count": 2
      },
      "response": "장기 장애로 분류, 우회 경로 검토",
      "followup": "API 실패 코드 분포 기준으로 공급자/네트워크 이슈 분리"
    },
    {
      "id": "state-cleanup-failed",
      "event": "state.cleanup.failed",
      "threshold_display": "단일 이벤트 즉시 경고",
      "fields": [
        "state_file",
        "error"
      ],
      "eval": {
        "type": "single_event"
      },
      "response": "파일 권한/경로/디스크 용량 확인",
      "followup": "스토리지 정책 수정 및 cleanup 재실행"
    },
    {
      "id": "state-migration-failed",
      "event": "state.migration.failed",
      "threshold_display": "단일 이벤트 즉시 경고",
      "fields": [
        "json_state_file",
        "sqlite_state_file",
        "error"
      ],
      "eval": {
        "type": "single_event"
      },
      "response": "마이그레이션 중지 후 JSON 모드 롤백",
      "followup": "원인 제거 후 재마이그레이션, 완료 이벤트 확인"
    }
  ]
}
